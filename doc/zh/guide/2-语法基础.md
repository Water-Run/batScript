# 语法基础  

## 概览  

`batScript`是一个强类型,结构化的语言.这意味着:  

- 所有变量必须先声明再使用.变量的类型不可变  
- 函数必须返回指定类型的返回值(无返回值的函数则成为过程)  
- 不支持面向对象  

在`batScript`中,还需要遵循以下规则:  

- 模块导入(`lib`/`pkg`)位于代码的最开头部分  
- 函数/过程(`func`/`proc`)必须先声明,后调用  
- 每一行的结尾需要`;`  

### 第一个示例程序  

以下是一个简单的示例程序.它做了一件很简单的事情:打印HelloWorld.  

```batscript
/*
:description: 最简单的 Hello World 程序
:file: hello.bs
:author: batScript示例
*/

lib Stdio;

# 主程序的入口
Stdio.out("Hello, World!");
```

### 第二个示例程序  

第二个示例程序则更加复杂: 包含了batScript的各种基本语法,以及库Cmd,Stdio的基本使用.可以先阅读代码,如果你有一定的编程基础,你会发现你可以基本读懂程序:  

```batscript
/*
:description: batScript 基础语法演示程序
:file: BasicSyntaxDemo.bs
:author: WaterRun
:time: 2025-09-04
*/

# 命名空间声明，遵循大驼峰命名规范
namespace BasicSyntaxDemo;

# 导入标准库
lib Stdio;                    # 标准输入输出库
lib Cmd => Console;           # 导入命令行工具库并重命名为Console
lib Type => _;                # 导入类型工具库到全局命名空间
lib Iterable => _;            # 导入可迭代对象工具库到全局命名空间

# 全局常量声明 - 使用大写+下划线的命名规范
let MAX_STUDENTS: num = 30;        # 最大学生数量限制
let PASSING_GRADE: num = 60;       # 及格分数线
let APP_VERSION: str = "1.0.0";    # 应用程序版本号

# 全局变量声明 - 使用小写+下划线的命名规范
set total_students: num = 0;       # 总学生数，初始化为0
set program_title: str = "学生成绩管理器";  # 程序标题

$$$ 这是原生注释，会保留在生成的.bat文件中
$$$ 用于说明这是一个教学演示程序，展示batScript的各种语法特性

/*
:description: 初始化程序环境，设置控制台外观
*/
proc initializeProgram()
{
    # Console.setColor方法可以接受颜色名称字符串，自动转换为对应的颜色代码
    # 常见颜色: "black", "blue", "green", "cyan", "red", "purple", "yellow", "white"
    # "light_blue", "light_green", "light_cyan", "light_red", "light_purple", "light_yellow", "bright_white"
    Console.setColor("light_green");      # 设置为亮绿色
    
    # 设置控制台窗口标题，使用字符串拼接操作符 ".."
    Console.setTitle(program_title .. " v" .. APP_VERSION);
    
    # 输出程序标题和版本信息
    Stdio.out("==============================");
    Stdio.out("  " .. program_title);
    Stdio.out("  版本: " .. APP_VERSION);
    Stdio.out("  作者: WaterRun");
    Stdio.out("==============================");
    Stdio.out("");  # 输出空行
}

/*
:description: 演示类型工具的使用
*/
proc demonstrateTypeUtils()
{
    Stdio.out("=== 类型工具演示 ===");
    
    # 声明各种类型的变量
    set default_num: num;           # 使用默认值 0
    set default_str: str;           # 使用默认值 ""
    set default_bool: bool;         # 使用默认值 false
    set default_arr: arr<str>;      # 使用默认值 空数组
    
    set custom_num: num = 42;
    set custom_str: str = "Hello";
    set custom_bool: bool = true;
    set custom_arr: arr<str> = ["A", "B", "C"];
    
    # 使用Type工具检查是否为默认值
    Stdio.out("默认值检查:");
    Stdio.out("default_num是默认值: " .. Int.isDefault(default_num));     # true
    Stdio.out("custom_num是默认值: " .. Int.isDefault(custom_num));       # false
    Stdio.out("default_str是默认值: " .. Str.isDefault(default_str));     # true
    Stdio.out("custom_str是默认值: " .. Str.isDefault(custom_str));       # false
    Stdio.out("default_bool是默认值: " .. Bool.isDefault(default_bool));  # true
    Stdio.out("custom_bool是默认值: " .. Bool.isDefault(custom_bool));    # false
    
    # 数组默认值检查
    Stdio.out("default_arr是默认值: " .. Arr.StrArr.isDefault(default_arr));  # true
    Stdio.out("custom_arr是默认值: " .. Arr.StrArr.isDefault(custom_arr));    # false
    
    # 获取默认值
    set new_default_num: num = Int.getDefault();
    set new_default_str: str = Str.getDefault();
    set new_default_bool: bool = Bool.getDefault();
    
    Stdio.out("获取的默认值:");
    Stdio.out("数字默认值: " .. new_default_num);       # 0
    Stdio.out("字符串默认值: '" .. new_default_str .. "'");  # ''
    Stdio.out("布尔默认值: " .. new_default_bool);      # false
    Stdio.out("");
}

/*
:description: 演示可迭代对象工具的使用
*/
proc demonstrateIterableUtils()
{
    Stdio.out("=== 可迭代对象工具演示 ===");
    
    # 字符串操作
    set sample_text: str = "Hello batScript";
    set words: arr<str> = ["apple", "banana", "cherry"];
    
    # 使用Iterable工具的字符串方法
    set text_length: num = Str.length(sample_text);           # 获取字符串长度
    set upper_text: str = Str.toUpper(sample_text);           # 转换为大写
    set lower_text: str = Str.toLower(sample_text);           # 转换为小写
    set contains_script: bool = Str.contains(sample_text, "Script");  # 检查是否包含子串
    
    Stdio.out("字符串操作:");
    Stdio.out("原文本: " .. sample_text);
    Stdio.out("长度: " .. text_length);
    Stdio.out("大写: " .. upper_text);
    Stdio.out("小写: " .. lower_text);
    Stdio.out("包含'Script': " .. contains_script);
    
    # 数组操作
    set array_length: num = Arr.length(words);                # 获取数组长度
    set first_item: str = Arr.first(words);                   # 获取第一个元素
    set last_item: str = Arr.last(words);                     # 获取最后一个元素
    set joined_text: str = Arr.join(words, ", ");             # 用分隔符连接数组元素
    
    Stdio.out("");
    Stdio.out("数组操作:");
    Stdio.out("原数组: [" .. joined_text .. "]");
    Stdio.out("长度: " .. array_length);
    Stdio.out("第一个元素: " .. first_item);
    Stdio.out("最后一个元素: " .. last_item);
    Stdio.out("");
}

/*
:description: 计算数组平均值 - 展示基本数组操作
:param scores: 分数数组
:return: 平均分
*/
func calculateAverage(scores: arr<num>) -> num
{
    # 使用 & 操作符获取数组长度
    set length: num = &scores;
    
    # 边界条件检查：空数组的处理
    if (length == 0)
    {
        return 0;            # 空数组返回0
    }
    
    set sum: num = 0;        # 累加器
    set score: num;          # 迭代变量，注意：在iterate循环中必须预先声明
    
    # iterate循环：遍历可迭代对象（如数组）
    iterate score from scores
    {
        set sum = sum + score;  # 累加所有分数
    }
    
    # 返回平均值（总和除以数量）
    return sum / length;
}

/*
:description: 统计及格人数
:param scores: 分数数组
:return: 及格人数
*/
func countPassing(scores: arr<num>) -> num
{
    set count: num = 0;
    set score: num;
    
    iterate score from scores
    {
        if (score >= PASSING_GRADE)
        {
            set count = count + 1;
        }
    }
    
    return count;
}

/*
:description: 判断分数等级
:param score: 学生分数
:return: 等级字符串
*/
func getGrade(score: num) -> str
{
    # 多层if-elif-else结构，从高到低判断等级
    if (score >= 90)
    {
        return "优秀";
    }
    elif (score >= 80)        # elif = else if
    {
        return "良好";
    }
    elif (score >= 70)
    {
        return "中等";
    }
    elif (score >= 60)
    {
        return "及格";
    }
    else                      # 所有条件都不满足时执行
    {
        return "不及格";
    }
}

/*
:description: 显示学生成绩
:param names: 学生姓名数组
:param scores: 分数数组
*/
proc showResults(names: arr<str>, scores: arr<num>)
{
    set name_count: num = &names;
    set score_count: num = &scores;
    
    # 数据一致性检查：两个数组长度必须相同
    if (name_count ~= score_count)  # ~= 表示不等于
    {
        err "错误：姓名和分数数组长度不一致！";
    }
    
    Stdio.out("学生成绩单:");
    Stdio.out("------------------------");
    
    # 使用while循环和索引访问来并行遍历两个数组
    set i: num = 0;
    while (i < name_count)
    {
        set name: str = names[i];        # 通过索引访问数组元素
        set score: num = scores[i];
        set grade: str = getGrade(score);   # 调用函数获取等级
        
        # 格式化输出学生信息
        Stdio.out(name .. ": " .. score .. "分 (" .. grade .. ")");
        set i = i + 1;       # 索引递增
    }
    
    Stdio.out("------------------------");
}

/*
:description: 显示统计信息
:param scores: 分数数组
*/
proc showStatistics(scores: arr<num>)
{
    # 在函数内访问全局变量需要使用global关键字
    global total_students;
    
    set total_students = &scores;
    set average: num = calculateAverage(scores);
    set passing_count: num = countPassing(scores);
    set passing_rate: num = (passing_count * 100) / total_students;
    
    Stdio.out("");
    Stdio.out("统计信息:");
    Stdio.out("总人数: " .. total_students);
    Stdio.out("平均分: " .. average);
    Stdio.out("及格人数: " .. passing_count);
    Stdio.out("及格率: " .. passing_rate .. "%");
}

/*
:description: 演示数组操作
*/
proc demonstrateArrayOps()
{
    Stdio.out("");
    Stdio.out("=== 数组操作演示 ===");
    
    # 创建两个小数组
    set group1: arr<num> = [85, 92, 78];
    set group2: arr<num> = [88, 76, 94];
    
    Stdio.out("小组1: " .. arrayToString(group1));
    Stdio.out("小组2: " .. arrayToString(group2));
    
    # 数组拼接操作：使用 ".." 操作符
    set combined: arr<num> = group1 .. group2;
    Stdio.out("合并后: " .. arrayToString(combined));
    
    # 数组颠倒操作：使用 "!" 操作符
    set reversed: arr<num> = !combined;
    Stdio.out("颠倒后: " .. arrayToString(reversed));
    
    Stdio.out("小组1长度: " .. &group1 .. ", 合并后长度: " .. &combined);
    Stdio.out("");
}

/*
:description: 将数组转换为字符串显示
:param arr: 数字数组
:return: 格式化的字符串
*/
func arrayToString(arr: arr<num>) -> str
{
    set result: str = "[";
    set element: num;
    set first: bool = true;
    
    iterate element from arr
    {
        if (not first)              # not 是逻辑非操作符
        {
            set result = result .. ", ";
        }
        
        set result = result .. element;
        set first = false;
    }
    
    set result = result .. "]";
    return result;
}

/*
:description: 演示多元条件运算符
:param choice: 用户选择
*/
proc handleChoice(choice: str)
{
    Stdio.out("处理选择: " .. choice .. " -> ");
    
    # 多元条件运算符：从左到右检查条件，最早满足的条件触发函数调用
    (choice == "1") | (choice == "显示") ? showOption1();
    (choice == "2") | (choice == "统计") ? showOption2();
    (choice == "help") | (choice == "帮助") ? showHelp();
    (choice == "exit") | (choice == "退出") ? showExit();
}

/*
:description: 选项1的处理
*/
proc showOption1()
{
    Stdio.out("执行显示功能");
}

/*
:description: 选项2的处理
*/
proc showOption2()
{
    Stdio.out("执行统计功能");
}

/*
:description: 帮助选项的处理
*/
proc showHelp()
{
    Stdio.out("显示帮助信息");
}

/*
:description: 退出选项的处理
*/
proc showExit()
{
    Stdio.out("准备退出程序");
}

/*
:description: 演示原生批处理集成
*/
proc demonstrateNativeCommands()
{
    Stdio.out("");
    Stdio.out("=== 系统信息 ===");
    
    # run块：允许执行原生的批处理命令
    run
    {
        "echo 当前时间:",
        "date /t",
        "time /t",
        "echo 用户: %USERNAME%",
        "echo 计算机: %COMPUTERNAME%";
    }
    
    Stdio.out("");
}

# ========== 主程序开始 ==========

# 初始化程序环境
initializeProgram();

# 演示类型工具
demonstrateTypeUtils();

# 演示可迭代对象工具
demonstrateIterableUtils();

# 创建示例数据
set students: arr<str> = ["张三", "李四", "王五", "赵六", "孙七"];
set scores: arr<num> = [85, 92, 78, 88, 76];

# 显示成绩
showResults(students, scores);

# 显示统计
showStatistics(scores);

# 演示数组操作
demonstrateArrayOps();

# 演示用户选择处理
Stdio.out("=== 用户选择演示 ===");
set choices: arr<str> = ["1", "2", "help", "exit"];
set choice: str;

iterate choice from choices
{
    handleChoice(choice);
}

# 演示系统命令
demonstrateNativeCommands();

# 程序结束信息
Stdio.out("程序演示完成！");
Stdio.out("处理了 " .. total_students .. " 名学生的数据");
Stdio.out("感谢使用 batScript!");

$$$ 程序自然结束，展示完所有基本语法特性
```

## 注释  

`batScript`中,有三种注释形式.  

### 单行注释  

使用`#`表示单行注释.`#`及同行之后的内容将被注释掉.  

```batscript
let const_1: num = 1 + 1; # 单行注释: 最基础的运算.常量可以在构建时通过表达式赋值
```

### 多行注释  

`/*`和`*/`中间的内容将被视为多行注释.  

```batscript
/*
导入Stdio包,并输出Hello World
*/
lib Stdio;
Stdio.out('Hello World')
```

多行注释也可以嵌入到代码之中:  

```batscript
set str_array: arr/*多行注释的内嵌形式: <arr>表明这是一个字符串数组*/<str>;
```

#### 文档字符串  

为提高代码的可读性,根据规范,在文件开头和函数/方法前需要加入符合范式的多行注释,称为文档字符串.  

> 在`batScript`中,使用`::`包裹文档字符串中的对应项  

##### 文件开头的文档字符串  

```batscript
/*
:description: A batScript sample 
:file: sample.bs
:author: WateRun
:time: 2025-09-04
*/
```

包含以下内容:  

- `description`: 文件的描述
- `file`: 文件名  
- `author`: 作者  
- `time`: 时间  

包含的内容可以自行添加和修改.  

##### 函数/过程的文档字符串  

```batscript
/*
:description: a function that do noting 
:param param_1: first num param
:param param_2: second string param
:return: return an empty bool array
*/
func myFunc(param_1: num, param2: str) -> arr<bool>
{
    set result: arr<bool> = [];
    return result;
}
```

包含以下内容:  

- `description`: 文件的描述
- `file`: 文件名  
- `author`: 作者  
- `time`: 时间  

## 编码规范  

在编写`.bs`时,需要遵循如下编码规范:  

- 变量名: 使用小写+下划线.如`my_var`  
- 常量名: 使用大写+下划线.如`A_CONST`  
- 函数和过程: 使用小驼峰.如`thisIsAFunction`  
- 文件名和命名空间: 使用大驼峰.如`NewNamespace`,`FirstBs.bs`  
- 括号单启一行  
- 符号添加空格  
- 编写文档字符串  

`bsc`会默认检查这些编程规范并抛出对应警告,以保障代码质量,除非使用`--ignore-format`参数忽略格式检查.  
在`batScript`中,名称不能包含四个连续的`_`,即`____`.这涉及到`batScript`的内部实现机制.  
