# 语法基础

`教程` `2025-12-12`  

---

## 语言特性

`BatScript`是一个静态的, 结构化的语言. 这意味着:

- 程序由上到下依次执行
- 变量是强类型的. 所有变量必须先声明再使用, 且变量类型不可变
- 函数必须返回指定类型的返回值(无返回值的函数则称为过程)
- 变量的作用域是全局的, 除非位于函数或过程中  
- 不支持面向对象

## 语法规则

编写`BatScript`时, 需要遵循以下规则:

- 命名区分大小写
- 每一行的结尾需要`;`
- 模块导入(`lib`/`pkg`)位于代码的最开头部分
- 脚本文件以`.bs`作为后缀名
- 没有显式的程序入口函数/过程要求; 自动的从上至下到第一个可执行的代码段  

此外,`batScript`有以下默认行为:

- 脚本默认关闭回显`@echo off`  

## 注释

`BatScript`中, 有两种注释形式, 和特殊的文档注释.

### 单行注释

使用`#`表示单行注释.`#`及同行之后的内容将被注释掉.

```batscript
def const_1: num = 1 + 1; # 单行注释: 最基础的运算. 常量可以在构建时通过表达式赋值
```

### 多行注释

`<#`和`#>`中间的内容将被视为多行注释.  

```batscript
<#
导入Cmd包, 并开启echo回显和标题
#>
lib Cmd;

setCmdEcho(true);
setCmdTitle("BatScript Program");
```

> 多行注释的`<#`和`#>`必须独占一行  

### 文档注释  

以`--@[类型]: [内容]`格式的片段称为文档注释, 用于格式化的解释代码.  
文档注释可位于以下结构的上方:  

- 文件开头, 任何有效代码部分之前  
- 变量或常量之前  
- 函数或过程之前  
- 直接控制流(`err`或`endprogram`)之前  

不同类型的文档字符串有不同的类型限制(除少数如`Parameter`外, 不可重复):  

*文件开头:*  

- `Description`: 描述  
- `File`: 文件名  
- `Author`: 作者
- `Time`: 时间  
- `Contact`: 联系方式  
- `Version`: 版本  
- `License`: 许可证
- `Copyright`: 版权  
- `Hint`: 提示(可重复)  

*变量/常量:*  

- `Description`: 描述  
- `Range`: 取值范围  
- `Unit`: 单位
- `Example`: 示例值(可重复)  
- `Hint`: 提示(可重复)  

*函数/过程:*  

- `Description`: 描述  
- `Parameter`: 参数(可重复)  
- `Return`: 返回值(仅函数)
- `Error`: 错误情况(可重复)  
- `Example`: 使用示例(可重复)  
- `Hint`: 提示(可重复)  

*直接控制流:*  

- `Description`: 描述  
- `When`: 条件  
- `Hint`: 提示(可重复)  

> 在默认模式下, `BatScript`编译器要求每个文件和函数/过程必须有文档注释. 详见[编译严格级别]()  

## 编码规范

在编写`.bs`时, 需要遵循如下编码规范:

- 有意义的变量和函数/过程名
- 括号单启一行(即ALLMAN风格)
- 二元运算符间添加空格
- 编写文档字符串

并遵循以下命名规范:

- 变量名: 使用小写+下划线. 如`my_var`
- 常量名: 使用大写+下划线. 如`A_CONST`
- 函数/过程: 使用小驼峰. 如`thisIsAFunction`
- 文件名: 使用大驼峰. 如`NewNamespace`,`FirstBs.bs`

> 关于编码规范的详细说明,见[编码规范详细说明文档]()

## 示例程序

接下来, 你可以尝试直接阅读以下示例代码, 看看你能不能读懂. 如果你发现读起来很容易, 那么你基本入门`BatScript`了.

### 第一个示例程序

以下是一个简单的示例程序. 它做了一件很简单的事情: 打印HelloWorld.

```batscript
--@Description: 最简单的 Hello World 程序
--@File: HelloWorld.bs
--@author: batScript示例

echoln "Hello World!"; # 打印HelloWorld 
```

说明:

- `--@`: 文档注释  
- `#`: 单行注释  
- `echoln`: 打印一行语句  

> 如果需要打印一行不换行的内容, 使用`echo`  

### 第二个示例程序  

第二个示例程序是一个简单的猜字符串, 你可以看基本的输入输出, 变量声明等语法.  

```batscript
--@Description: 猜字符串
--@File: GuessString.bs
--@author: batScript示例

let correct: str = "Hello World"! # 声明一个字符串常量
set guess_input: str; # 声明一个字符串变量, 默认为空值 Nil

guess_input = input "Input your guess: "; # 将输入传至guess_input变量, 输入提示为 Input your guess: 

# 选择判断
if (guess_input == correct)
{
    echoln "You are correct.";
}
else
{
    echoln "You are wrong.";
}

pause; # 暂停程序
```

说明:  

- `let`和`set`: 声明常量/变量. 类型声明后置  
- `input`: 获取输入的字符串  
- `pause`: 和`.bat`的`pause`等效, 暂停脚本执行  

### 第三个示例程序

第三个则是一个简单的四则运算器: 接受用户的输入并执行计算.

```batscript
--@Description: 四则计算器
--@File: BasicCalculator.bs
--@author: batScript示例

lib Type; # 使用 类型 库, 提供类型转换函数

echoln ":::BatScript Basic Calculator:::";

loop # 无限循环, 等效于 while (True)
{
    echoln 'Choice an Opeartion:\n    [1]Add\n    [2]Minus\n    [3]Multipy\n    [4]Divide\n    [0]Exit\n'; # 使用单引号声明的字符串支持`\n`转义符  

    # var 声明局部变量, 在循环结束后会被自动清除
    var choice: str = input "Input your choice>>>";
    var first: str = input "Input first number>>>";
    var second: str = input "Input second number>>>";

    # 值匹配分支语法糖
    match(choice)
    {
        condition("0")
        {
            break;
        }
        condition("1")
        {
            result = strToNum(first) + strToNum(second); # 类型 库提供的类型转换函数
        }
        condition("2")
        {
            result = strToNum(first) - strToNum(second);
        }
        condition("3")
        {
            result = strToNum(first) * strToNum(second);
        }
        condition("4")
        {
            result = strToNum(first) / strToNum(second);
        }
    }
    else # 未匹配
    {
            echoline "Invalid Input: " .. choice .. ". Retry."; # 使用`..`进行字符串拼接
            continue;
    }
    

    echoline "Result: " .. numToStr(result);
}
echoline "Bye.";
```

说明:  

- `loop`: 无限循环. `batScript`的循环还包括`while`, `repeat`, 以及可迭代体循环`iterate`和`circle`  
- `match-condition-else`: `if-else`的语法糖. 匹配某个特定值  
- `break`和`continue`: 循环控制  

前三个程序比较紧凑, 之后的代码量较多, 你可以[点击此]()先跳转至下一章节的内容.  

### 第四个示例程序

第四个示例程序这是一个升级版的Cmd终端. 你可以看到函数和过程以及内嵌基础.  

```batscript
--[[
:description: Cmd++
:file: Cmd++.bs
:author: batScript示例
]]

lib Cmd;
lib Time;

set command: str?;
set start_time: num?;
setCmdTitle("Cmd++");

loop => count
{
    start_time = timeStampNow();
    command = input ">>>";    
    if(command ~= "title")
    {

    }
    else
    {
        runraw(command);
        echo "Exec in " .. timeStampNow() - start_time .. "ms";
    }
}
```

使用:  

说明:  

### 第五个示例程序

一个经典的学生成绩管理系统.  

### 第六个示例程序

一个赛车小游戏. 分为几个文件:  

## 保留字和运算符

以下列出了`BatScript`中的所有保留字:  

| 名称           | 说明      |
| ------------ | ------- |
| `set`        | 声明变量    |
| `let`        | 声明常量    |
| `var`        | 声明局部变量    |
| `num`        | 数字型     |
| `str`        | 字符串型    |
| `bol`        | 布尔型     |
| `arr`        | 数组型     |
| `lib`        | 导入库     |
| `pkg`        | 导入文件    |
| `if`         | 选择      |
| `elif`       | 选择分支    |
| `else`       | 选择其它    |
| `match`      | 匹配      |
| `codition`   | 匹配情况    |
| `while`      | 普通循环    |
| `loop`       | 无限循环    |
| `repeat`     | 次数循环    |
| `iterate`    | 可迭代体循环  |
| `circle`     | 可迭代体环循环 |
| `continue`   | 跳过本轮循环  |
| `break`      | 循环中止    |
| `and`        | 且       |
| `or`         | 或       |
| `not`        | 非       |
| `proc`       | 声明过程    |
| `func`       | 声明函数    |
| `return`     | 返回值     |
| `err`        | 异常中止      |
| `endprogram` | 程序中止    |
| `insert`     | 嵌入批处理文件 |
| `runraw`     | 内嵌批处理代码 |
| `echo`       | 输出(不换行) |
| `echoln`     | 输出(换行) |
| `input`      | 读取输入 |
| `pause`      | 暂停程序 |
| `Nil`        | 空值字面量 |
| `True`       | 布尔真字面量 |
| `False`      | 布尔假字面量 |
| `Inf`        | 无限数字面量 |

以下列出了`BatScript`中的所有保留字:  

| 名称           | 说明      |
| ------------ | ------- |
| `+`        | 数值加法运算符    |
| `-`        | 数值减法运算符    |
| `*`        | 数值乘法运算符    |
| `/`        | 数值除法运算符    |
| `%`        | 数值取模运算符    |
| `>`        | 数值大于比较运算符    |
| `>=`       | 数值大等于比较运算符    |
| `<`        | 数值小于比较运算符    |
| `<=`       | 数值小等于比较运算符    |
| `==`       | 等于比较运算符    |
| `~=`       | 不等于比较运算符    |
| `=`        | 赋值运算符    |
| `!`        | 取反运算符    |
| `?`        | 判空运算符    |
| `..`       | 字符串拼接运算符    |
| `<->`      | 一维数组拼接运算符    |
| `\|`       | 一维数组追加运算符    |
| `@`        | 可迭代体取长运算符    |
| `&`        | 取类型字符串运算符    |
| `$`        | 取原始运算符    |

## 最常用的库说明  

以下列出了一些你在写代码时可能会使用到的最常用的库:  

### `Type`库  

`Type`库提供了一些类型相关的功能.  

#### 类型转换相关  

```batscript

```

### `Iterateable`库  

### `Math`库  

### `Cmd`库  

---

**导航**

[上一个](./02-安装与使用.md) | [下一个](./04-类型系统.md)  
[教程目录](./01-教程目录.md) | [手册导览](../manual/手册导引.md) | [返回 README](../../../README-zh.md)
